#!/bin/sh  
#
# Working sintax:
#
# Put:
# $ bcp [ --put-file | --put-list | --reput ] 
# --put-file	Adding file to repo. Exmpl: $ bcp --put-file /etc/hosts
# --put-list	Adding files from existing list to repo.
# --reput	Adding files from existing list to repo.
#
# Restore:
# $ bcp [ --get-file | --get-list | --reget ] 
# --get-file	Get file from repo. Exmpl: $ bcp --get-file /etc/hosts
# --get-list	Get all files from existing list to OS.
# --reget	Re-get files from existing list to OS.

basedir=$(dirname $0)

uname=$(uname -a)
if echo $uname grep -iq gentoo; then
	baseos=gentoo
elif echo $uname grep -iq debian; then
	baseos=debian
elif echo $uname grep -iq ubuntu; then
	baseos=ubuntu
else
	baseos=linux
fi>/dev/null 2>&1

for i in $HOME/.zshrc \
$HOME/.tmux.conf \
$HOME/.gitconfig \
$HOME/.vimrc \
/var/lib/portage/world \
/etc/portage/make.conf \
/etc/portage/package.use \
/etc/portage/package.mask \
/etc/portage/package.keywords \
$(ls -da1 /usr/src/linux-*-gentoo/.* | grep config) \
$(find /etc/kernels -type f); do
a=$(realpath $i); 
mkdir -p $basedir/$baseos${a%/*}
#cp -f $a $basedir/$baseos${a%/*}/ 
rsync -av $a $basedir/$baseos${a%/*}/ 
done>/dev/null 2>&1

(cd $basedir; git status | grep -qF 'working directory clean' || (git add *; git add .*; git ls-files --deleted -z | xargs -0 git rm; git commit -m "Commit via Cron at $(date +%d.%m.%Y-%H:%M)" )) > /dev/null 2>&1

###################################################################

#git status | grep -qF 'working directory clean' || echo "DIRTY"
#rsync
#$(ls -da1 /usr/src/linux-*-gentoo/.* | grep config)
#$(find /etc/kernels -type f)
#
# uname -a | grep -q gentoo
# case switch

# sudo dmidecode -t baseboard | grep 'Manuf\|Prod'|awk -F ": " '{print $2}'|tr -d "\n" > /tmp/11
# sudo dmidecode -t system |grep -i 'manufacturer\|product\|version'|awk -F ": " '{print $2}'|tr -d '\040\011\012\015'
# LENOVO32492GUThinkPadX201

# uname=$(uname -a); if echo $uname|grep -qi debian;then echo Debian; elif echo $uname|grep -qi gento;then echo Gentoo; else echo linux; fi

# baseos=$(hostnam || pwd)>/dev/null 2>&1

#basename
#dirname
